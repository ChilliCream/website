<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Building a .NET GraphQL Client API · ChilliCream</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="**This post has been updated, please head over to the newer post [here](https://chillicream.com/blog/2019/11/25/strawberry-shake_2).**"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Building a .NET GraphQL Client API · ChilliCream"/><meta property="og:type" content="website"/><meta property="og:url" content="https://chillicream.com/blog/2019/09/27/strawberry-shake"/><meta property="og:description" content="**This post has been updated, please head over to the newer post [here](https://chillicream.com/blog/2019/11/25/strawberry-shake_2).**"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://chillicream.com/img/signet.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css"/><link rel="alternate" type="application/atom+xml" href="https://chillicream.com/blog/atom.xml" title="ChilliCream Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://chillicream.com/blog/feed.xml" title="ChilliCream Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-72800164-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:700,400"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script type="text/javascript" src="/js/google-adsense.js"></script><script type="text/javascript" src="/js/disqus.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/signet.png" alt="ChilliCream"/><h2 class="headerTitleWithLogo">ChilliCream</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="https://shop.chillicream.com" target="_blank">Shop</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>All blog posts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">All blog posts</h3><ul class=""><li class="navListItem"><a class="navItem" href="/blog/2019/12/26/hotchocolate-10.3.0">GraphQL - Hot Chocolate 10.3.0</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/11/29/schema-design">Lets supercharge your GraphQL schema :)</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/11/25/strawberry-shake_2">Building a real-time .NET GraphQL Client API</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/blog/2019/09/27/strawberry-shake">Building a .NET GraphQL Client API</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/08/14/hot-chocolate-10.0.0">GraphQL - Hot Chocolate 10.0.0</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/06/05/hot-chocolate-9.0.0">GraphQL - Hot Chocolate 9.0.0</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/05/08/performance">GraphQL - Hot Chocolate 9.0.0 - Performance Improvements</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/04/12/type-system">GraphQL - Hot Chocolate 9.0.0 - Type System</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/04/11/integration-tests">GraphQL - How to write integration tests against Hot Chocolate</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/03/31/hot-chocolate-0.8.1">GraphQL - Hot Chocolate 0.8.1</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/03/19/logging-with-hotchocolate">GraphQL - Tracing with Hot Chocolate</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/03/04/hot-chocolate-0.8.0">GraphQL - Hot Chocolate 0.8.0</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/02/20/schema-stitching">GraphQL - Schema Stitching with Version 8</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/02/04/instrumentation-and-apollo-tracing">GraphQL .NET Instrumentation API and Apollo Tracing</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/02/04/hot-chocolate-0.7.0">GraphQL - Hot Chocolate 0.7.0</a></li><li class="navListItem"><a class="navItem" href="/blog/2019/01/24/schema-stitching">GraphQL - Schema Stitching</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/11/07/docusaurus-docs-redirect">Docusaurus - How to redirect requests to /docs to a default url instead of getting a 404 error</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/09/02/hot-chocolate-0.4.5">GraphQL - Hot Chocolate 0.4.5</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/07/31/hot-chocolate-0.4.0">GraphQL - Hot Chocolate 0.4.0</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/07/30/green-donut-0.2.0">Green Donut 0.2.0</a></li><li class="navListItem"><a class="navItem" href="/blog/2018/05/03/react-rasta-1.0.0">React Rasta 1.0.0</a></li><li class="navListItem"><a class="navItem" href="/blog/2013/09/12/jquery-steps-form-wizard">How to create a Form Wizard using jQuery Steps</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer postContainer blogContainer"><div class="wrapper"><div class="lonePost"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2019/09/27/strawberry-shake">Building a .NET GraphQL Client API</a></h1><p class="post-meta">September 27, 2019</p><div class="authorBlock"><p class="post-authorName"><a href="https://github.com/michaelstaib" target="_blank" rel="noreferrer noopener">Michael Staib</a></p><div class="authorPhoto"><a href="https://github.com/michaelstaib" target="_blank" rel="noreferrer noopener"><img src="https://avatars1.githubusercontent.com/u/9714350?s=100&amp;v=4" alt="Michael Staib"/></a></div></div></header><div><span><p><img src="/img/blog/strawberry-shake-banner.svg" alt="Strawberry Shake"></p>
<p><strong>This post has been updated, please head over to the newer post <a href="https://chillicream.com/blog/2019/11/25/strawberry-shake_2">here</a>.</strong></p>
<p>We for a while now have two big GraphQL server projects on the .NET platform. So, if you just want to build a decent GraphQL server you can pick and choose between <em>GraphQL .NET</em> or <em>Hot Chocolate</em>.</p>
<p>If you are looking at consuming a GraphQL server in your <em>Blazor</em> or <em>Xamarin</em> application, then things are not so promising. You can either go with a bare bone client from the <em>GraphQL .NET</em> project or you can decide to go it alone and build on <code>HttpClient</code>.</p>
<p>After the version 10 release of our <em>Hot Chocolate</em> GraphQL server we have started to build a new GraphQL client API that is more in line with how people in JavaScript consume GraphQL endpoints.</p>
<!--truncate-->
<h2><a class="anchor" aria-hidden="true" id="introduction"></a><a href="#introduction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>Before we get into it let me first outline what our goals for our approach are:</p>
<ul>
<li>Strongly typed API.</li>
<li>Define the API with GraphQL.</li>
<li>No magic strings.</li>
<li>Everything compiles.</li>
<li>Customizable request pipelines.</li>
<li>Support for local resolvers.</li>
<li>Support for custom scalars.</li>
</ul>
<p>The preview that we released today is a prototype that has a ton of bugs and is meant at the moment to get feedback. Starting with this preview we will now release every other day a new preview and think that we will release this new API with version 11 of <em>Hot Chocolate</em>.</p>
<h2><a class="anchor" aria-hidden="true" id="getting-started"></a><a href="#getting-started" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Getting Started</h2>
<p>Let us have a look at how we want to tackle things with <em>Strawberry Shake</em>. For this little walkthrough I will use our <a href="https://github.com/ChilliCream/hotchocolate/tree/master/examples/AspNetCore.StarWars"><em>Star Wars</em> server example</a>.</p>
<p>If you want to follow along then install the <a href="https://dotnet.microsoft.com/download/dotnet-core/3.0">.NET Core 3 SDK</a> . We are also supporting other .NET variants but for this example you will need the .NET Core 3 SDK.</p>
<p>Before we can start let us clone the <em>Hot Chocolate</em> repository and start our <em>Star Wars</em> server.</p>
<pre><code class="hljs css language-bash"><span class="token function">git</span> clone https://github.com/ChilliCream/hotchocolate.git
<span class="token builtin class-name">cd</span> hotchocolate
dotnet run --project examples/AspNetCore.StarWars/
</code></pre>
<p>Now that we have our <em>Star Wars</em> server running, lets create a folder for our client and install the <em>Strawberry Shake</em> tools.</p>
<pre><code class="hljs css language-bash"><span class="token function">mkdir</span> berry
dotnet new tool-manifest
dotnet tool <span class="token function">install</span> StrawberryShake.Tools --version <span class="token number">11.0</span>.0-preview.35 --local
</code></pre>
<p>In our example we are using the new .NET CLI local tools. <code>dotnet new tool-manifest</code> creates the tools manifest which basically is like a packages.config and holds the information of which tools in which version we are using.</p>
<p>The next command <code>dotnet tool install StrawberryShake.Tools --version 11.0.0-preview.35 --local</code> installs our <em>Strawberry Shake</em> tools.</p>
<p>Next we need a little project. Let’s create a new console application so that we can easily run and debug what we are doing.</p>
<pre><code class="hljs css language-bash">dotnet new console -n BerryClient
<span class="token builtin class-name">cd</span> BerryClient
dotnet <span class="token function">add</span> package StrawberryShake --version <span class="token number">11.0</span>.0-preview.35
dotnet <span class="token function">add</span> package Microsoft.Extensions.Http --version <span class="token number">3.0</span>.0
dotnet <span class="token function">add</span> package Microsoft.Extensions.DependencyInjection --version <span class="token number">3.0</span>.0
</code></pre>
<p>OK, now that we have a project setup lets initialize the project by creating a local schema. Like with <em>relay</em> we are holding a local schema file that can be extended with local types and fields. Our <em>Graphql</em> compiler will use this schema information to validate the queries.</p>
<blockquote>
<p>For the next step ensure that the <em>Star Wars</em> <em>GraphQL</em> server is running since we will fetch the schema from the server.</p>
</blockquote>
<pre><code class="hljs css language-bash">dotnet graphql init ./StarWars http://localhost:5000/graphql -n StarWars
</code></pre>
<p>The init command will download the schema as GraphQL SDL and create a config to refetch the schema. Also, the config contains the client name. The client name defines how the client class is and interface is named.</p>
<blockquote>
<p>Note: You can pass in the token and scheme if your endpoint is authenticated. There is also an update command to update the local schema.</p>
</blockquote>
<p>The configuration will look like the following:</p>
<pre><code class="hljs css language-json"><span class="token punctuation">{</span>
  <span class="token property">"Schemas"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"StarWars"</span><span class="token punctuation">,</span>
      <span class="token property">"Type"</span><span class="token operator">:</span> <span class="token string">"http"</span><span class="token punctuation">,</span>
      <span class="token property">"File"</span><span class="token operator">:</span> <span class="token string">"StarWars.graphql"</span><span class="token punctuation">,</span>
      <span class="token property">"Url"</span><span class="token operator">:</span> <span class="token string">"http://localhost:5000/graphql"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"ClientName"</span><span class="token operator">:</span> <span class="token string">"StarWarsClient"</span>
<span class="token punctuation">}</span>
</code></pre>
<p>OK, now let’s get started by creating our first client API. For this open your editor of choice. I can recommend using VSCode for this at the moment since you will get GraphQL highlighting. As we move forward, we will refine the tooling more and provide proper IntelliSense.</p>
<p>Now let us create a new file in our <code>StarWars</code> folder called <code>Queries.graphql</code> and add the following query:</p>
<pre><code class="hljs css language-graphql"><span class="token keyword">query</span> getFoo <span class="token punctuation">{</span>
  foo
<span class="token punctuation">}</span>
</code></pre>
<p>Now build your project.</p>
<pre><code class="hljs css language-bash">dotnet build
</code></pre>
<p>When we now compile, we get an <em>MSBuild</em> error on which we can click in VSCode and we are pointed to the place in our query file from which the error stems from. The error tells us that there is no field <code>foo</code> on the <code>Query</code> type.</p>
<pre><code class="hljs css language-bash">/Users/michael/Local/play/berry/BerryClient/StarWars/Queries.graphql<span class="token punctuation">(</span><span class="token number">2,3</span><span class="token punctuation">)</span>: error GQL: The field <span class="token variable"><span class="token variable">`</span>foo<span class="token variable">`</span></span> does not exist on the <span class="token builtin class-name">type</span> <span class="token variable"><span class="token variable">`</span>Query<span class="token variable">`</span></span><span class="token builtin class-name">.</span> <span class="token punctuation">[</span>/Users/michael/Local/play/berry/BerryClient/BerryClient.csproj<span class="token punctuation">]</span>
</code></pre>
<p>Your GraphQL query document is not just a string, it properly compiles and is fully typed. Let's change our query to the following and compile again:</p>
<pre><code class="hljs css language-graphql"><span class="token keyword">query</span> getFoo <span class="token punctuation">{</span>
  hero <span class="token punctuation">{</span>
    name
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<pre><code class="hljs css language-bash">dotnet build
</code></pre>
<p>Now our project changes and we get a new <code>Generated</code> folder that has all the types that we need to communicate with our backend.</p>
<p>Let us have a look at our client interface for a minute.</p>
<pre><code class="hljs css language-csharp"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IStarWarsClient</span>
<span class="token punctuation">{</span>
    Task<span class="token operator">&lt;</span>IOperationResult<span class="token operator">&lt;</span>IGetFoo<span class="token operator">>></span> <span class="token function">GetFooAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Task<span class="token operator">&lt;</span>IOperationResult<span class="token operator">&lt;</span>IGetFoo<span class="token operator">>></span> <span class="token function">GetFooAsync</span><span class="token punctuation">(</span>
        <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The client will have for each operation in your query file one method that will execute that exact operation.</p>
<p>Since, with GraphQL you essentially design your own service API by writing a query document your types can become quite messy very quickly.</p>
<p>In order to avoid getting a messy API and to give you control over how your C# API will look like we are using fragments to infer types.</p>
<p>Let us redesign our query with fragments and make it a bit more complex.</p>
<pre><code class="hljs css language-graphql"><span class="token keyword">query</span> getHero <span class="token punctuation">{</span>
  hero <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token fragment function">SomeDroid</span>
    <span class="token operator">...</span><span class="token fragment function">SomeHuman</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fragment</span> <span class="token fragment function">SomeHuman</span> <span class="token keyword">on</span> <span class="token class-name">Human</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token fragment function">HasName</span>
  homePlanet
<span class="token punctuation">}</span>

<span class="token keyword">fragment</span> <span class="token fragment function">SomeDroid</span> <span class="token keyword">on</span> <span class="token class-name">Droid</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token fragment function">HasName</span>
  primaryFunction
<span class="token punctuation">}</span>

<span class="token keyword">fragment</span> <span class="token fragment function">HasName</span> <span class="token keyword">on</span> <span class="token class-name">Character</span> <span class="token punctuation">{</span>
  name
<span class="token punctuation">}</span>
</code></pre>
<p>The fragments will yield in the following type structure:</p>
<pre><code class="hljs css language-csharp"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ISomeHuman</span>
    <span class="token punctuation">:</span> <span class="token class-name">IHasName</span>
<span class="token punctuation">{</span>
    <span class="token keyword">string</span> HomePlanet <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ISomeDroid</span>
    <span class="token punctuation">:</span> <span class="token class-name">IHasName</span>
<span class="token punctuation">{</span>
    <span class="token keyword">string</span> PrimaryFunction <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IHasName</span>
<span class="token punctuation">{</span>
    <span class="token keyword">string</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>As we go forward, we will introduce some directives that will let you further manipulate the types like <code>@spread</code>. <code>@spread</code> will let you spread the fields of a child object over its parent object.</p>
<p>Let's make one more tweak to our query and then we get this example running.</p>
<pre><code class="hljs css language-graphql"><span class="token keyword">query</span> getHero<span class="token punctuation">(</span><span class="token variable">$episode</span><span class="token punctuation">:</span> Episode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  hero<span class="token punctuation">(</span><span class="token attr-name">episode</span><span class="token punctuation">:</span> <span class="token variable">$episode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token fragment function">SomeDroid</span>
    <span class="token operator">...</span><span class="token fragment function">SomeHuman</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fragment</span> <span class="token fragment function">SomeHuman</span> <span class="token keyword">on</span> <span class="token class-name">Human</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token fragment function">HasName</span>
  homePlanet
<span class="token punctuation">}</span>

<span class="token keyword">fragment</span> <span class="token fragment function">SomeDroid</span> <span class="token keyword">on</span> <span class="token class-name">Droid</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token fragment function">HasName</span>
  primaryFunction
<span class="token punctuation">}</span>

<span class="token keyword">fragment</span> <span class="token fragment function">HasName</span> <span class="token keyword">on</span> <span class="token class-name">Character</span> <span class="token punctuation">{</span>
  name
<span class="token punctuation">}</span>
</code></pre>
<p>By definig a variable with our operation we now can pass in arguments into our operation.</p>
<pre><code class="hljs css language-csharp"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IStarWarsClient</span>
<span class="token punctuation">{</span>
    Task<span class="token operator">&lt;</span>IOperationResult<span class="token operator">&lt;</span>IGetHero<span class="token operator">>></span> <span class="token function">GetHeroAsync</span><span class="token punctuation">(</span>
        <span class="token class-name">Episode</span> episode<span class="token punctuation">)</span><span class="token punctuation">;</span>

    Task<span class="token operator">&lt;</span>IOperationResult<span class="token operator">&lt;</span>IGetHero<span class="token operator">>></span> <span class="token function">GetHeroAsync</span><span class="token punctuation">(</span>
        <span class="token class-name">Episode</span> episode<span class="token punctuation">,</span>
        <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>OK, let's get it running and then go into more details. By default the generator will also generate dependency injection code for <code>Microsoft.Extensions.DependencyInjection</code>. In order to get our client up and running we just have to set up a dependency injection container.</p>
<blockquote>
<p>Note: You can shut of dependency injection generation with a <em>MSBuild</em> property. The client can also be instantiated with a builder or by using a different dependency injection container.</p>
</blockquote>
<p>Replace you <code>Program</code> class with the following code.</p>
<pre><code class="hljs css language-csharp"><span class="token keyword">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> serviceCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServiceCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serviceCollection<span class="token punctuation">.</span><span class="token function">AddDefaultScalarSerializers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serviceCollection<span class="token punctuation">.</span><span class="token function">AddStarWarsClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serviceCollection<span class="token punctuation">.</span><span class="token function">AddHttpClient</span><span class="token punctuation">(</span><span class="token string">"StarWarsClient"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ConfigureHttpClient</span><span class="token punctuation">(</span>client <span class="token operator">=></span>
                client<span class="token punctuation">.</span>BaseAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uri</span><span class="token punctuation">(</span><span class="token string">"http://localhost:5000/graphql"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">IServiceProvider</span> services <span class="token operator">=</span> serviceCollection<span class="token punctuation">.</span><span class="token function">BuildServiceProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IStarWarsClient</span> client <span class="token operator">=</span> services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token punctuation">&lt;</span><span class="token class-name">IStarWarsClient</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        IOperationResult<span class="token operator">&lt;</span>IGetHero<span class="token operator">></span> result <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetHeroAsync</span><span class="token punctuation">(</span>Episode<span class="token punctuation">.</span>Newhope<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ISomeDroid<span class="token punctuation">)</span>result<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>Hero<span class="token punctuation">)</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>

        result <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetHeroAsync</span><span class="token punctuation">(</span>Episode<span class="token punctuation">.</span>Empire<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ISomeHuman<span class="token punctuation">)</span>result<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>Hero<span class="token punctuation">)</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Run the console and it will output the following;</p>
<pre><code class="hljs css language-bash">R2-D2
Luke Skywalker
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="generation-options"></a><a href="#generation-options" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generation Options</h2>
<p>By default, <em>Strawberry Shake</em> will generate C# 7.3 without nullable reference types. We also by default generate dependency injection code for <code>Microsoft.Extensions.DependencyInjection</code>.</p>
<p>If the generator detects that you are using C# 8.0 and enabled support for nullable reference types, then the generate is switching to produce code with nullable reference types.</p>
<pre><code class="hljs css language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PropertyGroup</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LangVersion</span><span class="token punctuation">></span></span>8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LangVersion</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Nullable</span><span class="token punctuation">></span></span>enable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Nullable</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PropertyGroup</span><span class="token punctuation">></span></span>
</code></pre>
<p>In order to manually overwrite those defaults, we added some build properties that you can use.</p>
<pre><code class="hljs css language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PropertyGroup</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BerryLangVersion</span><span class="token punctuation">></span></span>CSharp_8_0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BerryLangVersion</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BerryEnableDI</span><span class="token punctuation">></span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BerryEnableDI</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BerryNamespace</span><span class="token punctuation">></span></span>$(RootNamespace)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BerryNamespace</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PropertyGroup</span><span class="token punctuation">></span></span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="dependency-injection"></a><a href="#dependency-injection" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependency Injection</h2>
<p>The client API can be used with other dependency injection container and also without dependency injection at all.</p>
<p>The execution pipeline can be extended or completely swapped out. This is an important aspect of <em>Strawberry Shake</em> since this allows us to add cross-cutting concerns like auto-batching, persisted query support and other features.</p>
<pre><code class="hljs css language-csharp"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">IServiceCollection</span> <span class="token function">TryAddDefaultHttpPipeline</span><span class="token punctuation">(</span>
    <span class="token keyword">this</span> <span class="token class-name">IServiceCollection</span> serviceCollection<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    serviceCollection<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">TryAddSingleton</span><span class="token punctuation">&lt;</span><span class="token class-name">OperationDelegate</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
        sp <span class="token operator">=></span> HttpPipelineBuilder<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Use</span><span class="token punctuation">&lt;</span><span class="token class-name">CreateStandardRequestMiddleware</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Use</span><span class="token punctuation">&lt;</span><span class="token class-name">SendHttpRequestMiddleware</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Use</span><span class="token punctuation">&lt;</span><span class="token class-name">ParseSingleResultMiddleware</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span>sp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> serviceCollection<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>When used with Microsoft's dependency injection container then we are also using the <code>IHttpFactory</code> which allows for integration with polly and others.</p>
<h2><a class="anchor" aria-hidden="true" id="roadmap"></a><a href="#roadmap" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Roadmap</h2>
<p>We are still heavy at work on the client and generator and this first preview is where we invite people to try it out in order to get feedback.</p>
<p>There is still a ton of work to be done and a ton of tests to be written to get this up for prime time.</p>
<p>We will have I think two more weeks to work on the generator to iron out generation issues. We will add documentation tags and things like that over the next view weeks.</p>
<p>Also, there are some generator directives that should show up next week like <code>@spread</code>, <code>@name</code> and <code>@type</code>.</p>
<p>Moreover, we will add support for local schema stitching. We already integrated the stitching engine into the generator but have a view more things to do before this works properly.</p>
<p>Local schema stitching will allow you to focus on your client API without having to wonder which client you have to use for which service. Also, it will allow you to form one local schema from which you can generate the types exactly like you want them.</p>
<p>Furthermore, there are execution features that we are currently adding like auto-batching and manual-batching. Support for subscription, ´@defer´ and persisted queries are also coming.</p>
<p>Last but not least we have a lot to do on the tooling side. We want to have a nice integration with all Visual Studios and are working on things like live generation. You can get a feeling for this by doing <code>dotnet watch build</code>. We have updated the watch information to exclude the generated files and include the <em>GraphQL</em> files.</p>
<p>Please check it out and give us feedback so we can adjust and refine the experience further.</p>
<p>If you want to get into contact with us head over to our <a href="https://join.slack.com/t/hotchocolategraphql/shared_invite/enQtNTA4NjA0ODYwOTQ0LTViMzA2MTM4OWYwYjIxYzViYmM0YmZhYjdiNzBjOTg2ZmU1YmMwNDZiYjUyZWZlMzNiMTk1OWUxNWZhMzQwY2Q">slack channel</a> and join our community.</p>
<table>
<thead>
<tr><th><a href="https://join.slack.com/t/hotchocolategraphql/shared_invite/enQtNTA4NjA0ODYwOTQ0LTViMzA2MTM4OWYwYjIxYzViYmM0YmZhYjdiNzBjOTg2ZmU1YmMwNDZiYjUyZWZlMzNiMTk1OWUxNWZhMzQwY2Q">HotChocolate Slack Channel</a></th><th><a href="https://hotchocolate.io">Hot Chocolate Documentation</a></th><th><a href="https://github.com/ChilliCream/hotchocolate">Hot Chocolate on GitHub</a></th></tr>
</thead>
<tbody>
</tbody>
</table>
</span></div></div><div class="blogSocialSection"><div class="blogSocialSectionItem"><a href="https://twitter.com/share" class="twitter-share-button" data-text="Building a .NET GraphQL Client API" data-url="https://chillicream.com/blog/2019/09/27/strawberry-shake" data-related="true" data-show-count="false">Tweet</a></div></div></div><div class="blog-recent"><a class="button" href="/blog">Recent posts</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#introduction">Introduction</a></li><li><a href="#getting-started">Getting Started</a></li><li><a href="#generation-options">Generation Options</a></li><li><a href="#dependency-injection">Dependency Injection</a></li><li><a href="#roadmap">Roadmap</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/signet.png" alt="ChilliCream" width="64" height="64"/></a><div><h5>Projects</h5><a href="https://greendonut.io" target="_blank">Green Donut</a><a href="https://hotchocolate.io" target="_blank">Hot Chocolate</a><a href="https://react-rasta.com" target="_blank">React Rasta</a><a href="https://github.com/ChilliCream/thor-core" target="_blank">Thor</a></div><div><h5>Community</h5><a href="https://twitter.com/Chilli_Cream" target="_blank" rel="noreferrer noopener">Follow us on Twitter</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://shop.chillicream.com" target="_blank">Shop</a><a href="https://github.com/ChilliCream/website" target="_blank">GitHub</a><a href="https://github.com/ChilliCream/website/issues" target="_blank">Issues</a><a class="github-button" href="https://github.com/ChilliCream/website" data-icon="octicon-star" data-count-href="/chillicream/website/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2020 ChilliCream</section></footer></div><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script></body></html>